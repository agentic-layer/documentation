= Building Block View

== Request Flow
[plantuml, core-request-flow, format="svg"]
....
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
left to right direction

System_Ext(extFrontends, "External Frontends", "User interfaces")
System_Ext(extAgents, "External Agents", "Third-party AI agents")

Container_Boundary(k8sCluster, "Kubernetes Cluster") {
    Container(agentGateway, "Agent Gateway", "API Gateway", "Routes requests to appropriate agents")
    Container(agents, "AI Agents", "Agent Runtime", "Business logic and AI orchestration")
    Container(aiGateway, "AI Gateway", "LLM Proxy", "Manages LLM provider interactions")
}

System_Ext(llmProviders, "LLM Providers", "External AI services")

' Request flow
Rel(extFrontends, agentGateway, "Sends requests", "HTTPS/API")
Rel(extAgents, agentGateway, "Agent requests", "HTTPS/API")
Rel(agentGateway, agents, "Routes to agent", "Internal")
Rel(agents, aiGateway, "LLM requests", "Internal")
Rel(aiGateway, llmProviders, "API calls", "HTTPS")

LAYOUT_WITH_LEGEND()
@enduml
....

== Agent Runtime View
[plantuml, agent-runtime-view, format="svg"]
....
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
left to right direction

Container_Boundary(k8sCluster, "Kubernetes Cluster") {
    Container(agentOperator, "Agent Runtime Operator", "K8s Operator", "Manages agent gateway lifecycle")
    Container(agentGateway, "Agent Gateway", "API Gateway", "Routes requests to appropriate agents, maps APIs")
    Container(agents, "AI Agents", "Agent Runtime", "Business logic and AI orchestration")
}

' Management relationships
Rel(agentOperator, agentGateway, "Registers agents", "K8s API")
Rel(agentOperator, agents, "Configure agents", "K8s API")
Rel(agentGateway, agents, "Routes to agent", "Internal")

LAYOUT_WITH_LEGEND()
@enduml
....

== AI Gateway View
[plantuml, ai-gateway-view, format="svg"]
....
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
left to right direction

Container(agents, "AI Agents", "Agent Runtime", "Business logic and AI orchestration")

Container_Boundary(aiGateway, "AI Gateway") {
    Component(modelRouter, "Model Router", "Router", "Routes requests to appropriate LLM providers")
    Component(guardrails, "Guardrails", "Security Layer", "Content filtering and safety checks")
    Component(metrics, "Metrics", "Telemetry", "Collects and exports usage metrics")
    Component(tokenMgmt, "Access Token Management", "Auth", "Manages API keys and authentication")
}

System_Ext(llmProviders, "LLM Providers", "External AI services")

' AI Gateway flow
Rel(agents, aiGateway, "LLM requests", "HTTPS/API")
Rel(aiGateway, tokenMgmt, "Authenticates request", "Internal")
Rel(tokenMgmt, guardrails, "Authenticated request", "Internal")
Rel(guardrails, metrics, "Validated request", "Internal")
Rel(metrics, modelRouter, "Tracked request", "Internal")
Rel(modelRouter, llmProviders, "API calls", "HTTPS")

LAYOUT_WITH_LEGEND()
@enduml
....
